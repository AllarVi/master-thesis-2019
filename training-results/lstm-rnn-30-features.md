lstm-rnn-30-features.md

# fit and evaluate a model
def evaluate_model(trainX, trainy, testX, testy):
    verbose, epochs = 1, 20
    
    n_features = 30
    n_outputs = 2
    n_steps_per_epoch = len(trainX)
    
    lstm_units = 100
        
    model = Sequential()
    model.add(LSTM(lstm_units, input_shape=(None, n_features)))
    model.add(Dropout(0.5))
    model.add(Dense(lstm_units, activation='relu'))
    model.add(Dense(n_outputs, activation='softmax'))
    model.compile(loss='categorical_crossentropy', optimizer='adam', metrics=['accuracy'])
    
    print(model.summary())
    # fit network
    model.fit_generator(train_generator(trainX, trainy), steps_per_epoch=n_steps_per_epoch, epochs=epochs, verbose=verbose)
    # evaluate model
    _, accuracy = model.evaluate_generator(train_generator(testX, testy), steps=len(testX), verbose=0)
    
    return accuracy

Steps per epoch: 90
Model: "sequential_1"
_________________________________________________________________
Layer (type)                 Output Shape              Param #   
=================================================================
lstm_1 (LSTM)                (None, 100)               52400     
_________________________________________________________________
dropout_1 (Dropout)          (None, 100)               0         
_________________________________________________________________
dense_1 (Dense)              (None, 100)               10100     
_________________________________________________________________
dense_2 (Dense)              (None, 2)                 202       
=================================================================
Total params: 62,702
Trainable params: 62,702
Non-trainable params: 0
_________________________________________________________________
None
Epoch 1/20
90/90 [==============================] - 5s 55ms/step - loss: 0.6982 - accuracy: 0.5778
Epoch 2/20
90/90 [==============================] - 4s 48ms/step - loss: 0.7630 - accuracy: 0.5333
Epoch 3/20
90/90 [==============================] - 4s 48ms/step - loss: 0.7548 - accuracy: 0.4667
Epoch 4/20
90/90 [==============================] - 4s 44ms/step - loss: 0.7352 - accuracy: 0.4667
Epoch 5/20
90/90 [==============================] - 4s 49ms/step - loss: 0.7664 - accuracy: 0.5222
Epoch 6/20
90/90 [==============================] - 4s 45ms/step - loss: 0.7972 - accuracy: 0.4556
Epoch 7/20
90/90 [==============================] - 4s 45ms/step - loss: 0.7588 - accuracy: 0.4667
Epoch 8/20
90/90 [==============================] - 4s 46ms/step - loss: 0.7331 - accuracy: 0.5000
Epoch 9/20
90/90 [==============================] - 4s 44ms/step - loss: 0.7493 - accuracy: 0.4444
Epoch 10/20
90/90 [==============================] - 4s 43ms/step - loss: 0.7517 - accuracy: 0.4778
Epoch 11/20
90/90 [==============================] - 4s 46ms/step - loss: 0.7170 - accuracy: 0.4556
Epoch 12/20
90/90 [==============================] - 4s 46ms/step - loss: 0.7623 - accuracy: 0.4556
Epoch 13/20
90/90 [==============================] - 4s 47ms/step - loss: 0.7394 - accuracy: 0.4222
Epoch 14/20
90/90 [==============================] - 5s 59ms/step - loss: 0.7427 - accuracy: 0.4444
Epoch 15/20
90/90 [==============================] - 5s 55ms/step - loss: 0.7359 - accuracy: 0.4778
Epoch 16/20
90/90 [==============================] - 4s 46ms/step - loss: 0.7257 - accuracy: 0.4111
Epoch 17/20
90/90 [==============================] - 4s 47ms/step - loss: 0.6941 - accuracy: 0.5111
Epoch 18/20
90/90 [==============================] - 4s 44ms/step - loss: 0.7061 - accuracy: 0.5111
Epoch 19/20
90/90 [==============================] - 4s 46ms/step - loss: 0.7407 - accuracy: 0.4222
Epoch 20/20
90/90 [==============================] - 4s 46ms/step - loss: 0.7235 - accuracy: 0.4222
>#1 validation accuracy: 30.435
Steps per epoch: 90
Model: "sequential_2"
_________________________________________________________________
Layer (type)                 Output Shape              Param #   
=================================================================
lstm_2 (LSTM)                (None, 100)               52400     
_________________________________________________________________
dropout_2 (Dropout)          (None, 100)               0         
_________________________________________________________________
dense_3 (Dense)              (None, 100)               10100     
_________________________________________________________________
dense_4 (Dense)              (None, 2)                 202       
=================================================================
Total params: 62,702
Trainable params: 62,702
Non-trainable params: 0
_________________________________________________________________
None
Epoch 1/20
90/90 [==============================] - 5s 56ms/step - loss: 0.7324 - accuracy: 0.5556
Epoch 2/20
90/90 [==============================] - 4s 48ms/step - loss: 0.7431 - accuracy: 0.5556
Epoch 3/20
90/90 [==============================] - 4s 49ms/step - loss: 0.7229 - accuracy: 0.5333
Epoch 4/20
90/90 [==============================] - 5s 55ms/step - loss: 0.7878 - accuracy: 0.4778
Epoch 5/20
90/90 [==============================] - 4s 45ms/step - loss: 0.7368 - accuracy: 0.5000
Epoch 6/20
90/90 [==============================] - 4s 44ms/step - loss: 0.7769 - accuracy: 0.4778
Epoch 7/20
90/90 [==============================] - 4s 42ms/step - loss: 0.7485 - accuracy: 0.4778
Epoch 8/20
90/90 [==============================] - 4s 48ms/step - loss: 0.7653 - accuracy: 0.4000
Epoch 9/20
90/90 [==============================] - 5s 58ms/step - loss: 0.7339 - accuracy: 0.4556
Epoch 10/20
90/90 [==============================] - 6s 65ms/step - loss: 0.7264 - accuracy: 0.5000
Epoch 11/20
90/90 [==============================] - 4s 47ms/step - loss: 0.7120 - accuracy: 0.5111
Epoch 12/20
90/90 [==============================] - 4s 44ms/step - loss: 0.7305 - accuracy: 0.4778
Epoch 13/20
90/90 [==============================] - 4s 47ms/step - loss: 0.7236 - accuracy: 0.5222
Epoch 14/20
90/90 [==============================] - 5s 55ms/step - loss: 0.7131 - accuracy: 0.4778
Epoch 15/20
90/90 [==============================] - 4s 50ms/step - loss: 0.7166 - accuracy: 0.4222
Epoch 16/20
90/90 [==============================] - 4s 49ms/step - loss: 0.6953 - accuracy: 0.5444
Epoch 17/20
90/90 [==============================] - 5s 51ms/step - loss: 0.7077 - accuracy: 0.5444
Epoch 18/20
90/90 [==============================] - 4s 47ms/step - loss: 0.7171 - accuracy: 0.4889
Epoch 19/20
90/90 [==============================] - 4s 46ms/step - loss: 0.7135 - accuracy: 0.4667
Epoch 20/20
90/90 [==============================] - 4s 44ms/step - loss: 0.7162 - accuracy: 0.4222
>#2 validation accuracy: 69.565
Steps per epoch: 90
Model: "sequential_3"
_________________________________________________________________
Layer (type)                 Output Shape              Param #   
=================================================================
lstm_3 (LSTM)                (None, 100)               52400     
_________________________________________________________________
dropout_3 (Dropout)          (None, 100)               0         
_________________________________________________________________
dense_5 (Dense)              (None, 100)               10100     
_________________________________________________________________
dense_6 (Dense)              (None, 2)                 202       
=================================================================
Total params: 62,702
Trainable params: 62,702
Non-trainable params: 0
_________________________________________________________________
None
Epoch 1/20
90/90 [==============================] - 5s 60ms/step - loss: 0.7084 - accuracy: 0.5444
Epoch 2/20
90/90 [==============================] - 4s 48ms/step - loss: 0.8013 - accuracy: 0.4222
Epoch 3/20
90/90 [==============================] - 5s 56ms/step - loss: 0.8493 - accuracy: 0.5000
Epoch 4/20
90/90 [==============================] - 4s 43ms/step - loss: 0.7124 - accuracy: 0.5222
Epoch 5/20
90/90 [==============================] - 4s 46ms/step - loss: 0.7579 - accuracy: 0.4556
Epoch 6/20
90/90 [==============================] - 4s 44ms/step - loss: 0.7149 - accuracy: 0.5667
Epoch 7/20
90/90 [==============================] - 5s 51ms/step - loss: 0.7641 - accuracy: 0.5000
Epoch 8/20
90/90 [==============================] - 4s 43ms/step - loss: 0.7831 - accuracy: 0.4889
Epoch 9/20
90/90 [==============================] - 4s 42ms/step - loss: 0.7156 - accuracy: 0.5111
Epoch 10/20
90/90 [==============================] - 4s 43ms/step - loss: 0.7617 - accuracy: 0.4778
Epoch 11/20
90/90 [==============================] - 4s 46ms/step - loss: 0.7687 - accuracy: 0.4222
Epoch 12/20
90/90 [==============================] - 5s 53ms/step - loss: 0.7297 - accuracy: 0.4667
Epoch 13/20
90/90 [==============================] - 6s 68ms/step - loss: 0.6949 - accuracy: 0.5111
Epoch 14/20
90/90 [==============================] - 6s 71ms/step - loss: 0.7172 - accuracy: 0.4667
Epoch 15/20
90/90 [==============================] - 5s 54ms/step - loss: 0.7279 - accuracy: 0.4556
Epoch 16/20
90/90 [==============================] - 4s 43ms/step - loss: 0.7235 - accuracy: 0.5000
Epoch 17/20
90/90 [==============================] - 4s 49ms/step - loss: 0.6991 - accuracy: 0.5444
Epoch 18/20
90/90 [==============================] - 4s 47ms/step - loss: 0.7486 - accuracy: 0.4222
Epoch 19/20
90/90 [==============================] - 4s 42ms/step - loss: 0.7274 - accuracy: 0.4444
Epoch 20/20
90/90 [==============================] - 4s 42ms/step - loss: 0.7148 - accuracy: 0.4778
>#3 validation accuracy: 30.435
Steps per epoch: 90
Model: "sequential_4"
_________________________________________________________________
Layer (type)                 Output Shape              Param #   
=================================================================
lstm_4 (LSTM)                (None, 100)               52400     
_________________________________________________________________
dropout_4 (Dropout)          (None, 100)               0         
_________________________________________________________________
dense_7 (Dense)              (None, 100)               10100     
_________________________________________________________________
dense_8 (Dense)              (None, 2)                 202       
=================================================================
Total params: 62,702
Trainable params: 62,702
Non-trainable params: 0
_________________________________________________________________
None
Epoch 1/20
90/90 [==============================] - 5s 51ms/step - loss: 0.7359 - accuracy: 0.5667
Epoch 2/20
90/90 [==============================] - 4s 43ms/step - loss: 0.7253 - accuracy: 0.4889
Epoch 3/20
90/90 [==============================] - 4s 43ms/step - loss: 0.7597 - accuracy: 0.4556
Epoch 4/20
90/90 [==============================] - 5s 56ms/step - loss: 0.7280 - accuracy: 0.4889
Epoch 5/20
90/90 [==============================] - 4s 50ms/step - loss: 0.7594 - accuracy: 0.4556
Epoch 6/20
90/90 [==============================] - 5s 55ms/step - loss: 0.7217 - accuracy: 0.5111
Epoch 7/20
90/90 [==============================] - 5s 55ms/step - loss: 0.7464 - accuracy: 0.4778
Epoch 8/20
90/90 [==============================] - 5s 51ms/step - loss: 0.7367 - accuracy: 0.4667
Epoch 9/20
90/90 [==============================] - 5s 58ms/step - loss: 0.7314 - accuracy: 0.4778
Epoch 10/20
90/90 [==============================] - 5s 54ms/step - loss: 0.7482 - accuracy: 0.5000
Epoch 11/20
90/90 [==============================] - 5s 57ms/step - loss: 0.7504 - accuracy: 0.4444
Epoch 12/20
90/90 [==============================] - 5s 53ms/step - loss: 0.7279 - accuracy: 0.4778 0s - loss: 0
Epoch 13/20
90/90 [==============================] - 5s 52ms/step - loss: 0.7307 - accuracy: 0.5222
Epoch 14/20
90/90 [==============================] - 5s 51ms/step - loss: 0.7043 - accuracy: 0.4778
Epoch 15/20
90/90 [==============================] - 5s 52ms/step - loss: 0.7059 - accuracy: 0.5222
Epoch 16/20
90/90 [==============================] - 5s 54ms/step - loss: 0.7501 - accuracy: 0.4222
Epoch 17/20
90/90 [==============================] - 4s 48ms/step - loss: 0.7020 - accuracy: 0.4667
Epoch 18/20
90/90 [==============================] - 4s 46ms/step - loss: 0.7127 - accuracy: 0.4444
Epoch 19/20
90/90 [==============================] - 4s 46ms/step - loss: 0.7024 - accuracy: 0.4889
Epoch 20/20
90/90 [==============================] - 4s 47ms/step - loss: 0.7106 - accuracy: 0.4444
>#4 validation accuracy: 30.435
Steps per epoch: 90
Model: "sequential_5"
_________________________________________________________________
Layer (type)                 Output Shape              Param #   
=================================================================
lstm_5 (LSTM)                (None, 100)               52400     
_________________________________________________________________
dropout_5 (Dropout)          (None, 100)               0         
_________________________________________________________________
dense_9 (Dense)              (None, 100)               10100     
_________________________________________________________________
dense_10 (Dense)             (None, 2)                 202       
=================================================================
Total params: 62,702
Trainable params: 62,702
Non-trainable params: 0
_________________________________________________________________
None
Epoch 1/20
90/90 [==============================] - 5s 53ms/step - loss: 0.7661 - accuracy: 0.5222
Epoch 2/20
90/90 [==============================] - 4s 48ms/step - loss: 0.8108 - accuracy: 0.4778
Epoch 3/20
90/90 [==============================] - 4s 47ms/step - loss: 0.7577 - accuracy: 0.5222
Epoch 4/20
90/90 [==============================] - 5s 53ms/step - loss: 0.7718 - accuracy: 0.4444
Epoch 5/20
90/90 [==============================] - 4s 50ms/step - loss: 0.7271 - accuracy: 0.4889
Epoch 6/20
90/90 [==============================] - 4s 48ms/step - loss: 0.7023 - accuracy: 0.6000
Epoch 7/20
90/90 [==============================] - 4s 47ms/step - loss: 0.7496 - accuracy: 0.4778
Epoch 8/20
90/90 [==============================] - 5s 51ms/step - loss: 0.7742 - accuracy: 0.4333
Epoch 9/20
90/90 [==============================] - 5s 58ms/step - loss: 0.7103 - accuracy: 0.4556
Epoch 10/20
90/90 [==============================] - 5s 55ms/step - loss: 0.7496 - accuracy: 0.4667
Epoch 11/20
90/90 [==============================] - 5s 54ms/step - loss: 0.7640 - accuracy: 0.4444
Epoch 12/20
90/90 [==============================] - 4s 45ms/step - loss: 0.7302 - accuracy: 0.4778
Epoch 13/20
90/90 [==============================] - 4s 42ms/step - loss: 0.7150 - accuracy: 0.4667
Epoch 14/20
90/90 [==============================] - 4s 40ms/step - loss: 0.7443 - accuracy: 0.4889
Epoch 15/20
90/90 [==============================] - 4s 41ms/step - loss: 0.7369 - accuracy: 0.4111
Epoch 16/20
90/90 [==============================] - 4s 43ms/step - loss: 0.7184 - accuracy: 0.4444
Epoch 17/20
90/90 [==============================] - 4s 49ms/step - loss: 0.7335 - accuracy: 0.4000
Epoch 18/20
90/90 [==============================] - 6s 66ms/step - loss: 0.7118 - accuracy: 0.6000
Epoch 19/20
90/90 [==============================] - 6s 67ms/step - loss: 0.7366 - accuracy: 0.4222
Epoch 20/20
90/90 [==============================] - 5s 59ms/step - loss: 0.6963 - accuracy: 0.5444
>#5 validation accuracy: 30.435
[30.434781312942505, 69.5652186870575, 30.434781312942505, 30.434781312942505, 30.434781312942505]
Accuracy: 38.261% (+/-15.652)